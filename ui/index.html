<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dynamic Grid with Multi-Segment Rows</title>
    <style>
      .grid-container {
        display: grid;
        grid-template-columns: 120px repeat(24, 40px);
        grid-template-rows: repeat(4, 40px);
        gap: 0;
        position: relative;
      }
      .cell {
        width: 40px;
        height: 40px;
        border: 1px solid black;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }
      .label-cell {
        width: 120px;
        height: 40px;
        border: 1px solid black;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        background-color: #f0f0f0;
      }
      .dot {
        width: 10px;
        height: 10px;
        background-color: black;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 2;
      }
      .horizontal-line {
        position: absolute;
        height: 4px;
        background-color: blue;
        top: 50%;
        left: 0;
        right: 0;
        transform: translateY(-50%);
        z-index: 1;
      }
      .vertical-line {
        position: absolute;
        width: 4px;
        background-color: blue;
        left: 50%;
        z-index: 1;
      }
    </style>
  </head>
  <body>
    <div class="grid-container"></div>

    <script>
      const rowLabels = ["Off Duty", "Sleeper Berth", "Driving", "On Duty (not driving)"];

      async function fetchRowsFromAPI() {
        return {
          1: [
            { start: 3, end: 9, nextRow: 4 },
            { start: 16, end: 18, nextRow: 4 },
            { start: 22, end: 23, nextRow: null },
          ],
          2: [
            { start: 12, end: 13, nextRow: 3 },
            { start: 20, end: 22, nextRow: 1 },
          ],
          3: [
            { start: 10, end: 12, nextRow: 2 },
            { start: 13, end: 14, nextRow: 4 },
          ],
          4: [
            { start: 9, end: 10, nextRow: 3 },
            { start: 14, end: 16, nextRow: 1 },
            { start: 18, end: 20, nextRow: 2 },
          ],
        };
      }

      async function renderGrid() {
        const rowsConfig = await fetchRowsFromAPI();
        const gridContainer = document.querySelector(".grid-container");
        gridContainer.innerHTML = "";

        const rows = 4;
        const cols = 24;

        for (let row = 1; row <= rows; row++) {
          let labelCell = document.createElement("div");
          labelCell.className = "label-cell";
          labelCell.textContent = rowLabels[row - 1];
          gridContainer.appendChild(labelCell);

          for (let col = 1; col <= cols; col++) {
            let cell = document.createElement("div");
            cell.className = "cell";

            let segment = rowsConfig[row]?.find((seg) => seg.start === col || seg.end === col);
            if (segment) {
              let dot = document.createElement("div");
              dot.className = "dot";
              cell.appendChild(dot);
            }

            if (rowsConfig[row]) {
              let currentSegment = rowsConfig[row].find((seg) => seg.start === col);
              if (currentSegment) {
                let line = document.createElement("div");
                line.className = "horizontal-line";
                line.style.left = "50%";
                cell.appendChild(line);
              }

              currentSegment = rowsConfig[row].find((seg) => seg.end === col);
              if (currentSegment) {
                let line = document.createElement("div");
                line.className = "horizontal-line";
                line.style.right = "50%";
                cell.appendChild(line);

                if (currentSegment.nextRow !== null) {
                  let vLine = document.createElement("div");
                  vLine.className = "vertical-line";

                  let nextRow = currentSegment.nextRow;
                  let rowDiff = nextRow - row;

                  if (rowDiff > 0) {
                    vLine.style.top = "50%";
                    vLine.style.height = `${rowDiff * 100}%`;
                  } else {
                    vLine.style.top = "auto";
                    vLine.style.bottom = "50%";
                    vLine.style.height = `${-rowDiff * 100}%`;
                  }

                  cell.appendChild(vLine);
                }
              }
            }

            if (rowsConfig[row]?.some((seg) => seg.start < col && col < seg.end)) {
              let line = document.createElement("div");
              line.className = "horizontal-line";
              cell.appendChild(line);
            }

            gridContainer.appendChild(cell);
          }
        }
      }

      renderGrid();
    </script>
  </body>
</html>
